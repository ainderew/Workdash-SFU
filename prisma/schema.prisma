generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int        @id @default(autoincrement())
  email        String     @unique
  passwordHash String
  name         String?
  role         UserRole   @default(MEMBER)
  status       UserStatus @default(OFFLINE)
  level        Int        @default(1)
  lastLoginAt  DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  image        String?
  character    Character?
  presence     Presence?

  @@index([email])
}

model Character {
  id          Int           @id @default(autoincrement())
  userId      Int           @unique
  name        String
  type        CharacterType
  bodyId      Int
  eyesId      Int
  hairstyleId Int
  outfitId    Int
  itemId      Int?
  itemType    ItemType?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  accessoryId Int?
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Presence {
  userId     Int       @id
  isOnline   Boolean   @default(false)
  lastSeenAt DateTime?
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  ADMIN
  MEMBER
  GUEST
}

enum UserStatus {
  ONLINE
  OFFLINE
  FOCUS
}

enum CharacterType {
  ADULT
  CHILD
}

enum ItemType {
  SMARTPHONE
  LAPTOP
  TABLET
  NONE
}
