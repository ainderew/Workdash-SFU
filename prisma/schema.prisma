generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int            @id @default(autoincrement())
  email        String         @unique
  passwordHash String
  name         String?
  role         UserRole       @default(MEMBER)
  status       UserStatus     @default(OFFLINE)
  level        Int            @default(1)
  lastLoginAt  DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  image        String?
  character    Character?
  presence     Presence?
  settings     UserSettings?
  soccerStats  SoccerStats?

  @@index([email])
}

model Character {
  id          Int           @id @default(autoincrement())
  userId      Int           @unique
  name        String
  type        CharacterType
  bodyId      Int
  eyesId      Int
  hairstyleId Int
  outfitId    Int
  itemId      Int?
  itemType    ItemType?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  accessoryId Int?
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Presence {
  userId     Int       @id
  isOnline   Boolean   @default(false)
  lastSeenAt DateTime?
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  ADMIN
  MEMBER
  GUEST
}

enum UserStatus {
  ONLINE
  OFFLINE
  FOCUS
}

enum CharacterType {
  ADULT
  CHILD
}

enum ItemType {
  SMARTPHONE
  LAPTOP
  TABLET
  NONE
}

model UserSettings {
  id                   Int      @id @default(autoincrement())
  userId               Int      @unique
  playBackgroundMusic  Boolean  @default(true)
  volume               Float    @default(0.5)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model SoccerStats {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  speed     Int      @default(0)
  kickPower Int      @default(0)
  dribbling Int      @default(0)

  // --- MMR System Fields ---
  mmr       Int      @default(500) // Starting MMR
  winStreak Int      @default(0)   // Tracks consecutive wins
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model MatchHistory {
  id              Int      @id @default(autoincrement())
  userId          Int
  matchDate       DateTime @default(now())
  result          String   // "WIN" or "LOSS"
  isMVP           Boolean  @default(false)
  mmrDelta        Int
  newMmr          Int
  goals           Int      @default(0)
  assists         Int      @default(0)
  interceptions   Int      @default(0)
  rankAtTime      String
  ourScore        Int      @default(0)
  opponentScore   Int      @default(0)
  
  @@index([userId])
}
